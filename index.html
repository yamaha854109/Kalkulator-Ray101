<!DOCTYPE html>
<html lang="pl">
<head>
<title>üîß Kalkulator d≈Çugo≈õci ciƒôcia ekranu </title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* { box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 20px; min-height: 100vh; }
.container { max-width: 420px; margin: 0 auto; background: white; border-radius: 24px; box-shadow: 0 25px 50px rgba(0,0,0,0.25); overflow: hidden; }
.header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
.header h1 { margin: 0 0 8px 0; font-size: 26px; font-weight: 700; }
.header p { margin: 0; opacity: 0.95; font-size: 15px; font-style: italic; }
.content { padding: 30px; }
.input-group { margin-bottom: 24px; }
.unit-info { font-size: 13px; color: #555; margin-top: 6px; background: #f8f9ff; padding: 8px 12px; border-radius: 8px; border-left: 4px solid #2196f3; font-style: italic; cursor: pointer; transition: all 0.2s; }
.unit-info:hover { background: #e8edff; }
label { display: block; font-weight: 600; margin-bottom: 10px; color: #333; font-size: 16px; }
select, input[type="number"], input[type="text"] { width: 100%; padding: 18px; border: 2px solid #e1e5e9; border-radius: 16px; font-size: 18px; font-weight: 500; transition: all 0.3s ease; background: white; }
select:focus, input[type="number"]:focus, input[type="text"]:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 4px rgba(102,126,234,0.15); transform: translateY(-1px); }
.result { background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 28px; border-radius: 20px; text-align: center; font-size: 34px; font-weight: 700; margin: 24px 0; box-shadow: 0 12px 30px rgba(76,175,80,0.4); }
.error { background: linear-gradient(135deg, #f44336, #d32f2f); color: white; padding: 22px; border-radius: 16px; margin: 16px 0; font-size: 18px; font-weight: 600; text-align: center; }
.warning { background: linear-gradient(135deg, #ff9800, #f57c00); color: white; padding: 22px; border-radius: 16px; margin: 16px 0; font-size: 18px; font-weight: 600; }
.good { background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 22px; border-radius: 16px; margin: 16px 0; font-size: 18px; font-weight: 600; }
.zapas { background: linear-gradient(135deg, #FF9800, #F57C00); color: white; padding: 24px; border-radius: 20px; text-align: center; font-size: 26px; font-weight: 700; margin: 20px 0; box-shadow: 0 10px 25px rgba(255,152,0,0.4); }
.zapas small { opacity: 0.9; font-size: 14px; display: block; margin-top: 4px; }
.suggest { background: linear-gradient(135deg, #66bb6a, #4caf50); color: white; padding: 20px; border-radius: 16px; margin: 16px 0; font-size: 18px; font-weight: 600; text-align: center; box-shadow: 0 8px 20px rgba(102,187,106,0.4); }
.btn-group { display: flex; gap: 12px; margin: 28px 0; flex-wrap: wrap; }
button { flex: 1; padding: 18px; border: none; border-radius: 16px; font-size: 17px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; min-width: 120px; }
.btn-reset { background: linear-gradient(135deg, #ff9800, #fb8c00); color: white; }
.btn-pdf { background: linear-gradient(135deg, #2196f3, #1976d2); color: white; }
.btn-unit { background: linear-gradient(135deg, #ff5722, #e64a19); color: white; }
.btn-copy { background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white; }
button:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
button:active { transform: translateY(0); }
.history { background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 16px; padding: 20px; margin-top: 24px; max-height: 220px; overflow-y: auto; border: 1px solid #dee2e6; }
.history h4 { margin: 0 0 12px 0; color: #495057; font-size: 16px; }
.history-item { padding: 14px; border-bottom: 1px solid #dee2e6; font-size: 15px; cursor: pointer; transition: background 0.2s; }
.history-item:hover { background: #e9ecef; border-radius: 8px; }
.history-item:last-child { border-bottom: none; }
.history-item span { color: #6c757d; font-size: 13px; }
table { width: 100%; border-collapse: collapse; margin: 24px 0; font-size: 14px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
th, td { border: 1px solid #dee2e6; padding: 14px 8px; text-align: center; }
th { background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-weight: 600; }
tr:hover { background: #f8f9ff; cursor: pointer; }
.toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #323232; color: white; padding: 16px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; animation: slideUp 0.3s ease; }
@keyframes slideUp { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }
@media (max-width: 480px) { .result { font-size: 28px; padding: 22px; } .container { margin: 10px; border-radius: 20px; } button { min-width: 100px; font-size: 15px; } }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="container">
<div class="header">
<h1>üîß Kalkulator d≈Çugo≈õci ciƒôcia ekranu</h1>
<p>Odpad <strong>zawsze 20cm</strong> | Raychem fizyka</p>
</div>

<div class="content">
<div class="input-group">
<label>üí° ≈örednica kabla:</label>
<input type="number" id="D" step="0.01" placeholder="15.0" min="0">
<div class="unit-info" id="D-unit" onclick="toggleUnits()">üìè Kliknij dla prze≈ÇƒÖczenia jednostek</div>
</div>

<div id="suggestSize" class="suggest" style="display:none;">
üí° <strong>SUGEROWANY: <span id="suggestedRay">--</span></strong>
</div>

<div class="input-group">
<label>Rozmiar Ray 101:</label>
<select id="size">
<option value="3.0">Ray-101-3.0mm (2.5-5.0)</option>
<option value="4.0">Ray-101-4.0mm (3.5-7.5)</option>
<option value="6.0">Ray-101-6.0mm (4.5-9.5)</option>
<option value="7.5">Ray-101-7.5mm (7.0-14.0)</option>
<option value="10.0" selected>Ray-101-10.0mm (8.0-22.0)</option>
<option value="12.5">Ray-101-12.5mm (11.0-24.0)</option>
<option value="20.0">Ray-101-20.0mm (16.0-38.0)</option>
</select>
</div>

<div class="input-group">
<label>D≈Çugo≈õƒá kabla:</label>
<input type="number" id="L" step="0.01" placeholder="12.0" min="0">
<div class="unit-info" id="L-unit" onclick="toggleUnits()">üìè Kliknij dla prze≈ÇƒÖczenia jednostek</div>
</div>

<div class="input-group">
<label>üìù Notatka (opcjonalnie):</label>
<input type="text" id="note" placeholder="Nr zlecenia / projekt">
</div>

<div class="btn-group">
<button class="btn-reset" onclick="resetCalc()">üîÑ Reset</button>
<button class="btn-copy" onclick="copyResult()">üìã Kopiuj</button>
<button class="btn-pdf" onclick="exportPDF()">üìÑ PDF</button>
</div>

<div id="result" class="result">Wpisz ≈õrednicƒô i d≈Çugo≈õƒá</div>
<div id="status"></div>
<div id="zapas" class="zapas" style="display:none;">
Do ciƒôcia: -- <small>+zapas na ko≈Ñce</small>
</div>

<div id="history" class="history" style="display:none;">
<h4>üìã Ostatnie (kliknij przywr√≥ƒá)</h4>
<div id="historyList"></div>
</div>

<h3>Zakresy Ray 101</h3>
<table id="rangesTable">
<tr><th>Ray</th><th>Min</th><th>Max</th></tr>
<tr onclick="selectRay('3.0')"><td>3.0</td><td>2.5</td><td>5.0</td></tr>
<tr onclick="selectRay('4.0')"><td>4.0</td><td>3.5</td><td>7.5</td></tr>
<tr onclick="selectRay('6.0')"><td>6.0</td><td>4.5</td><td>9.5</td></tr>
<tr onclick="selectRay('7.5')"><td>7.5</td><td>7.0</td><td>14.0</td></tr>
<tr onclick="selectRay('10.0')" style="font-weight:bold"><td><b>10.0</b></td><td><b>8.0</b></td><td><b>22.0</b></td></tr>
<tr onclick="selectRay('12.5')"><td>12.5</td><td>11.0</td><td>24.0</td></tr>
<tr onclick="selectRay('20.0')"><td>20.0</td><td>16.0</td><td>38.0</td></tr>
</table>
<p style="font-size:13px;color:#666;">L_cut = L_opl + 0.20m | Raychem kalibrowane</p>
</div>
</div>

<script>
let units = {dia: 'mm', len: 'm'};
let history = JSON.parse(localStorage.getItem('ray101_history') || '[]');

const ranges = {
"3.0": {min:2.5, max:5.0, dref:3.75},
"4.0": {min:3.5, max:7.5, dref:5.5},
"6.0": {min:4.5, max:9.5, dref:7.0},
"7.5": {min:7.0, max:14.0, dref:10.5},
"10.0": {min:8.0, max:22.0, dref:15.0},
"12.5": {min:11.0, max:24.0, dref:17.5},
"20.0": {min:16.0, max:38.0, dref:27.0}
};

function updateUnitsDisplay() {
  const diaText = units.dia === 'mm' ? 'Aktualnie: mm (üìè kliknij dla cali)' : 'Aktualnie: cale (üìè kliknij dla mm)';
  const lenText = units.len === 'm' ? 'Aktualnie: m (üìè kliknij dla st√≥p)' : 'Aktualnie: stopy (üìè kliknij dla m)';
  document.getElementById('D-unit').textContent = diaText;
  document.getElementById('L-unit').textContent = lenText;
}

function selectRay(size) {
  document.getElementById('size').value = size;
  calc();
  showToast(`Wybrano Ray-101-${size}mm`);
}

function suggestRay(D_raw) {
  const D = units.dia === 'in' ? D_raw * 25.4 : D_raw;
  const suggestDiv = document.getElementById('suggestSize');
  if (!D || D <= 0) { suggestDiv.style.display = 'none'; return; }

  let suggested = null;
  for (let size in ranges) {
    if (D >= ranges[size].min && D <= ranges[size].max) {
      suggested = size;
      break;
    }
  }

  if (suggested) {
    document.getElementById('suggestedRay').textContent = `Ray-101-${suggested}mm`;
    suggestDiv.style.display = 'block';
    document.getElementById('size').value = suggested;
    calc();
  } else {
    suggestDiv.style.display = 'none';
  }
}

function calc() {
  const size = document.getElementById('size').value;
  let L_raw = parseFloat(document.getElementById('L').value);
  let D_raw = parseFloat(document.getElementById('D').value);
  const note = document.getElementById('note').value;

  if (isNaN(L_raw) || isNaN(D_raw) || L_raw <= 0 || D_raw <= 0) {
    document.getElementById('result').textContent = 'Wpisz ≈õrednicƒô i d≈Çugo≈õƒá';
    document.getElementById('status').innerHTML = '';
    document.getElementById('zapas').style.display = 'none';
    return;
  }

  let L = units.len === 'ft' ? L_raw * 0.3048 : L_raw;
  let D = units.dia === 'in' ? D_raw * 25.4 : D_raw;

  const data = ranges[size];
  const k = D / data.dref;
  const s = -0.15 * (k - 1) - 0.05 * Math.pow((k - 1), 2);
  const Lopl = L * (1 + s);

  const zapas_m = 0.20;
  const zapas_display = units.len === 'ft' ? (zapas_m / 0.3048) : zapas_m;
  let L_cut_m = Lopl + zapas_m;
  let wasForced = false;

  if (L_cut_m < 0.25) {
    L_cut_m = 0.25;
    wasForced = true;
  }

  const L_cut = units.len === 'ft' ? (L_cut_m / 0.3048) : L_cut_m;
  const Lopl_display = units.len === 'ft' ? (Lopl / 0.3048) : Lopl;
  const unit_label = units.len === 'ft' ? 'ft' : 'm';

  document.getElementById('result').textContent = Lopl_display.toFixed(2) + ' ' + unit_label;
  document.getElementById('zapas').style.display = 'block';

  const zapas_label = units.len === 'ft' ? `+${zapas_display.toFixed(2)}ft zapas` : '+20cm zapas (10cm√ó2 ko≈Ñce)';
  document.getElementById('zapas').innerHTML = `Do ciƒôcia: <strong>${L_cut.toFixed(2)} ${unit_label}</strong> <small>${zapas_label}</small>`;

  const status = document.getElementById('status');
  const minD_disp = units.dia === 'in' ? (data.min / 25.4).toFixed(2) + ' in' : data.min.toFixed(1) + ' mm';
  const maxD_disp = units.dia === 'in' ? (data.max / 25.4).toFixed(2) + ' in' : data.max.toFixed(1) + ' mm';

  let statusHTML = '';
  if (D < data.min) {
    statusHTML = `<div class="warning">‚ö†Ô∏è ZA MA≈ÅA! Min ${minD_disp}</div>`;
  } else if (D > data.max) {
    statusHTML = `<div class="error">‚ùå ZA DU≈ªA! Max ${maxD_disp}</div>`;
  } else {
    statusHTML = `<div class="good">‚úÖ ${minD_disp} - ${maxD_disp}</div>`;
  }

  if (wasForced) {
    statusHTML += `<div class="warning">‚ö†Ô∏è Wymuszono minimum 0.25m</div>`;
  }

  status.innerHTML = statusHTML;

  const entry = {
    size, 
    L: L_raw.toFixed(2), 
    D: D_raw.toFixed(2), 
    Lopl: Lopl_display.toFixed(2), 
    cut: L_cut.toFixed(2), 
    time: new Date().toLocaleTimeString(),
    units_dia: units.dia,
    units_len: units.len,
    note: note
  };

  history.unshift(entry);
  history = history.slice(0, 5);
  localStorage.setItem('ray101_history', JSON.stringify(history));
  updateHistory();
  window.lastCalc = entry;
}

function resetCalc() {
  document.getElementById('size').value = '10.0';
  document.getElementById('L').value = '';
  document.getElementById('D').value = '';
  document.getElementById('note').value = '';
  document.getElementById('suggestSize').style.display = 'none';
  document.getElementById('result').textContent = 'Wpisz ≈õrednicƒô i d≈Çugo≈õƒá';
  document.getElementById('status').innerHTML = '';
  document.getElementById('zapas').style.display = 'none';
}

function toggleUnits() {
  // Pobierz obecne warto≈õci
  const D_input = document.getElementById('D');
  const L_input = document.getElementById('L');
  let D_val = parseFloat(D_input.value);
  let L_val = parseFloat(L_input.value);

  // Konwertuj ≈õrednicƒô
  if (!isNaN(D_val) && D_val > 0) {
    if (units.dia === 'mm') {
      // mm -> cale
      D_val = D_val / 25.4;
    } else {
      // cale -> mm
      D_val = D_val * 25.4;
    }
    D_input.value = D_val.toFixed(2);
  }

  // Konwertuj d≈Çugo≈õƒá
  if (!isNaN(L_val) && L_val > 0) {
    if (units.len === 'm') {
      // m -> stopy
      L_val = L_val / 0.3048;
    } else {
      // stopy -> m
      L_val = L_val * 0.3048;
    }
    L_input.value = L_val.toFixed(2);
  }

  // Prze≈ÇƒÖcz jednostki
  units.dia = units.dia === 'mm' ? 'in' : 'mm';
  units.len = units.len === 'm' ? 'ft' : 'm';

  updateUnitsDisplay();

  // Przelicz sugestiƒô i wynik
  const D_val_check = parseFloat(D_input.value) || 0;
  suggestRay(D_val_check);
  calc();

  // Poka≈º komunikat
  const unitMsg = units.dia === 'in' ? 'Prze≈ÇƒÖczono na cale/stopy' : 'Prze≈ÇƒÖczono na mm/metry';
  showToast(unitMsg);
}

function updateHistory() {
  const list = document.getElementById('historyList');
  list.innerHTML = history.map(h => {
    const noteText = h.note ? ` | ${h.note}` : '';
    return `<div class="history-item" onclick="restoreFromHistory('${h.size}', '${h.D}', '${h.L}', '${h.units_dia}', '${h.units_len}', '${h.note || ''}')">
      Ray${h.size} | D${h.D}${h.units_dia} L${h.L}${h.units_len} ‚Üí tnij ${h.cut}${h.units_len}${noteText} <span>${h.time}</span>
    </div>`;
  }).join('');
  document.getElementById('history').style.display = history.length ? 'block' : 'none';
}

function restoreFromHistory(size, D, L, units_dia, units_len, note) {
  units.dia = units_dia;
  units.len = units_len;
  updateUnitsDisplay();
  document.getElementById('size').value = size;
  document.getElementById('D').value = D;
  document.getElementById('L').value = L;
  document.getElementById('note').value = note;
  calc();
  showToast('Przywr√≥cono z historii');
}

function copyResult() {
  if (!window.lastCalc) {
    showToast('Oblicz najpierw!');
    return;
  }
  const noteText = window.lastCalc.note ? ` | ${window.lastCalc.note}` : '';
  const text = `Ray-101-${window.lastCalc.size} | D=${window.lastCalc.D}${window.lastCalc.units_dia} L=${window.lastCalc.L}${window.lastCalc.units_len} ‚Üí TNIEJ: ${window.lastCalc.cut}${window.lastCalc.units_len}${noteText}`;
  navigator.clipboard.writeText(text).then(() => {
    showToast('‚úÖ Skopiowano do schowka!');
  }).catch(() => {
    showToast('‚ùå B≈ÇƒÖd kopiowania');
  });
}

function exportPDF() {
  if (!window.lastCalc) {
    showToast('Oblicz najpierw!');
    return;
  }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(24);
  doc.text('Ray 101 - Do ciecia', 20, 30);
  doc.setFontSize(16);
  doc.text(`Raychem Ray-${window.lastCalc.size}`, 20, 50);
  doc.text(`Kabel: D=${window.lastCalc.D}${window.lastCalc.units_dia} L=${window.lastCalc.L}${window.lastCalc.units_len}`, 20, 62);
  doc.text(`Oplot na kablu: ${window.lastCalc.Lopl}${window.lastCalc.units_len}`, 20, 74);
  doc.text(`TNIEJ: ${window.lastCalc.cut}${window.lastCalc.units_len} (+zapas)`, 20, 86);
  if (window.lastCalc.note) {
    doc.text(`Notatka: ${window.lastCalc.note}`, 20, 98);
  }
  doc.text(`Obliczone: ${window.lastCalc.time}`, 20, 110);
  doc.save(`Ray101_cut_${window.lastCalc.time.replace(/:/g, '-')}.pdf`);
  showToast('‚úÖ PDF zapisany!');
}

function showToast(message) {
  const existing = document.querySelector('.toast');
  if (existing) existing.remove();

  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.textContent = message;
  document.body.appendChild(toast);

  setTimeout(() => toast.remove(), 2500);
}

// Inicjalizacja
document.getElementById('D').addEventListener('input', e => suggestRay(parseFloat(e.target.value) || 0));
['size','L'].forEach(id => document.getElementById(id).addEventListener('input', calc));
document.getElementById('note').addEventListener('input', calc);
updateUnitsDisplay();
updateHistory();
</script>
</body>
</html>